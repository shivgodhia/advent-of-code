puzzle_input = """......#........#.............#.##..........................................#.......#...#........#......................#..........
.......................#...#................................#..#.........................................#.....#.....#............
.......................................#.................#..................#....#........................................#.......
.............#...................#.#...............................#....#....#.#.......................................#..#.......
...............................#........##.#..............................#..............................#..#...#..#..............
........................#......................................................................................#..#...............
............................#..........#.......#...................#.....#..................#.....................#..##...........
......................................................##........................#..............#........#..............#..#...#...
............................#.............................................##..........................................#...........
..........#............#....................................#...........#......................................................#..
....#......#.........................................#.......#...............................#..#.##..................#........#..
........................#.#..........##.#..........#......#.......#............................................................#..
..........................................................................................#.#..........................#..........
.............................#............#.......................#................#....................................#.........
...................................#.........................#.............#......#...#................................#.....#....
..........#..................#..#.....................#...#...#.........................................#................#........
....#....#...........#...#..........................................#.............#..#......#................#.....#..............
....................................................................................#......#....##..##....#.......................
...........................#......................#.........##................#............#.......................#...#..........
...........................#....................#............................................#........#.........................#.
..#......#.......#.#...........................#......#....#.#...#.............................#............#..............#......
.......#................#...................................#.........................#..................................#........
..................................................................#...........................................................#...
......................#....#........................................................................................#.............
...#..................#.......#......................................................................#.#....................#.....
................#....................................#.........#..#.........................#...............#.......#.............
.......................................#.................#..................................#...#...........#.....................
....#.....###..................#........#...#..............#............#...............................................#.........
...................#.......................................................#...................................#..................
....#......................................#...##.....#........#......#......#..........................................#.........
......................#............#...............#................#...............................#.............................
......................#..............................................#...........#............#.................................#.
#.#..............................#..#......#.............#.......#......................#...........#........#..........#.........
....#....#.......................................#.......................................................#........................
.......#............................#...........................#.........................#...............#.......................
.....................................#........#.....#........#.......................#...............#..........................#.
....#.......................................#........#......................................................#.................#...
............#..............#...#.......#..#.................................................................................##...#
...#..................#...................#....#............................................................................#.....
.....#....................#...............#.............................................#.....#...............................#...
..............................#.......................#.................#.......................................................#.
.........#....................#..............................................................................#.................#..
......#..................#.........................#.......#.....#...........#....#...................................#......#....
.........#...#......................#......#.................#.........................................#...................#......
....#....#.................................#..#..#........#............................................#.......#..................
....................#...........................#...#............#...........................#....................................
................#................#....#.......................................#....#..........#.#.#..........#....................
....#............................#...................................#.....................................................#.#....
....................................#............#......................#......................##.....................#.......#...
.........................#...................................#.....#................................................#.............
...........#.#..#............................................................................#.#..................................
....#......#.#..................................................#..#....#...#..#...................................#..............
#.........................#.#.................................................................#.#.............................#...
..................#...#........#.......................................................#....#..............................#...#..
.........#..........#.............................................................................................#...............
....................................................................#.......................#..#............#............#........
.................#.................#.............................................#..................................#.............
.#...................................................................................................#................#...........
...#....#.#.#.........#............#..............................................................................................
..................#...#......................................#...#.............#....#....#................#.......................
.....#................................##....................................................................#.....................
............#..................#......#....................#.....#.#.........................##............#............#.......#.
............................#..#.................#.............................................#..................................
............#...............#..........................................................#........#.................................
.......#.......#.......................................##..............##.........................................................
....................#.........#.....#..............#....#.......................................................#.................
...#............................................................#.............................................#...#............#..
....#..............................#...............................#..........................................#...................
............................................................................................................#....................#
..#.............................................................................................................#............#....
..........#...............#.........................................................#...........#.................................
...............#.....................#....................................#....................#.....#...#.....................#..
.#......#.........................................................................................#..#............................
......#..............#........#........#........#.........................................................#.......................
............................#...........#..#.............................................................................#........
..................#..............#.......................................#.........#...............#.....................#.#......
...........................................#.##...................................................................................
.......................#.............................................................................................#............
..........#................................#......#..............................#.................#........#......#.#.........#..
#.......#........................#.....#..........##......#................#......................................#..#..#......#..
........................##........................#....................#......................................#.................#.
..........................#.#........................................................................................#............
..........#.........#.....#......#............#..#................................................##.................#............
........#.....#............##...........................................#..#...............................................#.....#
..............#.......#......................#.....#.......................#.........#........#.................#...#....#........
..............#.................................#.................................................##..............................
................................#........#...........#........................................................#...................
..#.#..................#....#......#..............................#.....#....#.#.............#...............................#....
.....................................................................#......#.........#.......#.........................#....#..#.
.#..........................#.....#...........................................##..^.#..........................#....#....#....#...
...........................#..#................................................................#...#........#.........#...........
......#.................#..............#................#.........#........................#..#........#......#...................
.....#..................#..........#............................................................................#.#...........#...
..........#.........#.................................#......#....#...............#.....................#...#.....................
...........#.......#...........#..#...............#...#..............#...........................................#................
..............................................................#...................................................................
................#..............#.....................#.......#.....................................................#..............
#................#.......#.#..............................#..........................#.............................#..........#...
.#...#.........##..........#......................#....#.........#....................#...............................#.....#.....
....#......#.................#....................................#...............................................................
......#..........#...............................................................#....#...............#.....#.##..................
............................................................#..................#..#...................#.....#.....................
......................#.......#...#....#....................................#.............................#............#..........
.#.............#.....................#...............#.......#...............##.....#..................##...#.....................
........#........................................................###.#..........................................#.................
...##.#................................................................................................#..........................
.............##................#.............#....................#....#......................#........................#.....#....
..#.......#............................................#...............................................#..........................
.................#....#.......................................................#............#..#........................#.......#.#
...#..#......................#............#........#...........................................................................#..
....................................#.......................#.....................................#.....#..#......................
.#...............#......#...........#.....#........##....#.......#.....#...................................................#......
...................#...#............................#..##........#...........................#...........#........................
....................#.#.....................................................................................#......#..............
....#...........#....#...#...#.....................#............................................#..............#..................
......#.#......#................#......................................#...............#..........................................
.......#.#................#..............#.....................#.#......#..................#......................................
.....#................................#..............#.......#......##........#................................#..........#.......
.....................................#......#.........#...#.....#..........#..........................#...........................
......#.......#............................................................#..#....................#...............#.........#....
.........................#...........#.............#......#..#..............................................................#.....
.........#.......##.....#....................................#.....#..............#......#.......#..................##.........#..
.........................#...................#...#.....#...........................................#.................#..#.........
...........#..........#.......................................................................................................#..#
.....#................................................#...........................................................#....#..........
..............#.................................#.............#.........................................................#.........
............#.........................................................#.....#...............................................#.....
..................................................#.................#.............................#....#...#.........#.......#....
........#................#................................................................#................#....................#.
..................##............................###.........#.......#................#........#......#............#..............."""



import re
from collections import *

class Vec:
    def __init__(self, r, c):
        self.r = r
        self.c = c
    def __add__(self, other):
        return Vec(self.r + other.r, self.c + other.c)
    def __hash__(self):
        return hash((self.r, self.c))
    def __eq__(self, other):
        return self.r== other.r and self.c == other.c
    def copy(self):
        return Vec(self.r, self.c)

def part1():
    dir_to_vec = {"^": Vec(-1, 0), "v": Vec(1, 0), "<": Vec(0, -1), ">": Vec(0, 1)}
    next_dir = {cur:nxt for cur,nxt in re.findall("(.)(.)", "^>>vv<<^")}
    lines = puzzle_input.split("\n")
    regex = re.compile("[abc]")
    guard_pos = None
    for i, line in enumerate(lines):
        if match:=re.search(r"[v\^><]", line):
            guard_pos = Vec(i, match.span()[0])
            guard_dir = match.group()
    
    visited_pos = set()
    def in_map(vec):
        r, c = vec.r, vec.c
        return r >= 0 and c >= 0 and r < len(lines) and c < len(lines[0])
    OBSTRUCTION = "#"
    while in_map(guard_pos):
        visited_pos.add(guard_pos)
        # generate move for the guard
        next_pos = dir_to_vec[guard_dir] + guard_pos
        if in_map(next_pos) and lines[next_pos.r][next_pos.c] is OBSTRUCTION:
            guard_dir = next_dir[guard_dir]
            continue
        guard_pos = next_pos
        
    print(len(visited_pos))
        
# puzzle_input="""....#.....
# .........#
# ..........
# ..#.......
# .......#..
# ..........
# .#..^.....
# ........#.
# #.........
# ......#..."""  

# This one doesn't work, it's my poor attempt. You need to preprocess where the guard will skip ahead to, instead of iterating step by step.
def part2():
    dir_to_vec = {"^": Vec(-1, 0), "v": Vec(1, 0), "<": Vec(0, -1), ">": Vec(0, 1)}
    next_dir = {cur:nxt for cur,nxt in re.findall("(.)(.)", "^>>vv<<^")}
    lines = puzzle_input.split("\n")
    regex = re.compile("[abc]")
    guard_pos = None
    for i, line in enumerate(lines):
        if match:=re.search(r"[v\^><]", line):
            guard_pos = Vec(i, match.span()[0])
            guard_dir = match.group()
    
    visited_pos = set()
    def in_map(vec):
        r, c = vec.r, vec.c
        return r >= 0 and c >= 0 and r < len(lines) and c < len(lines[0])
    OBSTRUCTION = "#"
    starting_pos = guard_pos
    starting_dir = guard_dir
    
    # single pass: as visiting, check if each next move is valid obstruction
    count = 0
    
        
    while in_map(guard_pos):
        visited_pos.add((guard_pos, guard_dir))
        # generate move for the guard
        next_pos = dir_to_vec[guard_dir] + guard_pos
        if not in_map(next_pos):
            break
        if lines[next_pos.r][next_pos.c] is OBSTRUCTION:
            guard_dir = next_dir[guard_dir]
            continue
        else:
            # not an obstruction, what if it were?
            cur_projected_pos, cur_projected_dir = guard_pos.copy(), next_dir[guard_dir]
            # does marching the guard forward cause a link up?
            while in_map(cur_projected_pos):
                next_projected_pos = dir_to_vec[cur_projected_dir] + cur_projected_pos
                if not in_map(next_projected_pos):
                    break
                if lines[next_projected_pos.r][next_projected_pos.c] is OBSTRUCTION:
                    # turn
                    cur_projected_dir = next_dir[cur_projected_dir]
                    # this is a new pos,dir tuple. see if this actually is in visited_pos
                    if (cur_projected_pos, cur_projected_dir) in visited_pos:
                        count+=1
                        break
                    continue
                elif (next_projected_pos, cur_projected_dir) in visited_pos:
                    count += 1
                    break
                cur_projected_pos = next_projected_pos
                
            # if it runs off the map, it's over
            
        guard_pos = next_pos
    
    
    
    print(count)

part1()
# part2()
